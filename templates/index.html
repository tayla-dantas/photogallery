<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
  <title>PhotoGallery</title>

  <!-- CSS  -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="{{ url_for('static', filename="/css/materialize.css")}}" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="{{ url_for('static', filename="/css/style.css")}}" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="{{ url_for('static', filename="/css/custom.css")}}" type="text/css" rel="stylesheet" media="screen,projection"/>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css"/>
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <!-- JS  -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript"></script>
  <script src="{{ url_for('static', filename="js/init.js") }}"></script>
  <script src="{{ url_for('static', filename="js/materialize.js") }}"></script>

</head>
<body>
  <nav class="z-depth-5">
    <div class="nav-wrapper yellow darken-4 z-depth-3">
      <a href="#!" class="brand-logo">PhotoGallery</a>
    </div>
  </nav>

  <div class="section no-pad-bot roseBackground " id="index-banner">
    <div class="container">
      <br><br>
      <h1 class="header center orange-text">Thank you for sharing that moment with me!</h1>
      <div class="row center">
        <h5 class="header col s12 white-text">Please upload all of the cool photos you took of that beautiful day.</h5>
      </div>
      <div class="row center">
        <div class="file-upload">
            <input class="file-upload__input" type="file" name="myFile[]" id="myFile" multiple>
            <button class="file-upload__button btn-large waves-effect waves-light orange" type="button">Choose File(s)</button>
            <span class="file-upload__label white-text"></span>
        </div>
      </div>
      <br><br>
    </div>
  </div>


  <div class="container">
    <div class="section">
        <div class="row">
              {% for image in images %}
                <div class="col s6">
                    <img style='height: 100%; width: 100%; object-fit: contain' class="materialboxed" height="250" width="250" src="{{image}}">
                </div>
              {% endfor %}

        </div>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                var elems = document.querySelectorAll('.materialboxed');
                var instances = M.Materialbox.init(elems, options);
            });
            $(document).ready(function(){
                $('.materialboxed').materialbox();
            });
        </script>
    </div>
  </div>

  <footer class="page-footer black">
    <div class="container">
      <div class="row">
        <div class="col l6 s12">
          <h5 class="white-text">Gallery prototype</h5>
          <p class="grey-text text-lighten-4">First version of our centrilized PhotoGallery.</p>
        </div>
    </div>
    <div class="footer-copyright">
      <div class="container">
      Made by Tayla Tineu
      </div>
    </div>
    <script>
      var output = "";
       Array.prototype.forEach.call(
          document.querySelectorAll(".file-upload__button"),
          function(button) {
              const hiddenInput = button.parentElement.querySelector(
                ".file-upload__input"
              );
              const label = button.parentElement.querySelector(".file-upload__label");
              const defaultLabelText = "No file(s) selected";

              // Set default text for label
              label.textContent = defaultLabelText;
              label.title = defaultLabelText;

              button.addEventListener("click", function() {
                hiddenInput.click();
              });

              hiddenInput.addEventListener("change", event => {
                  const file = event.target.files[0];
                  const reader = new FileReader();
                  reader.addEventListener('load', event => {
                    output = event.target.result;
                    console.log(output);
                    var jsonString= JSON.stringify({img : output });
                    console.log(jsonString);
                    
                    const response = fetch('/store', {
                      method: 'POST',
                      body: jsonString, // string or object
                      headers: {
                        'Content-Type': 'application/json'
                      }
                    });

                     
                  });
                  reader.readAsDataURL(file);
                  label.textContent = "Upload completed, please refresh the page.";
                  label.title = "Upload completed, please refresh the page.";
                  M.toast({html: 'Please refresh the page'})
              });

          }

      );
    
    </script>

  </footer>

  

  </body>
</html>
